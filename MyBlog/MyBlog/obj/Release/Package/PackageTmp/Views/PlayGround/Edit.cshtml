@model MyBlog.Models.playground
@{
    ViewBag.Title = "Edit";
    Layout = null;
}

<style type="text/css">
#editForm{
 /*background-color:Gray;*/
}
</style>
<script type="text/javascript">

    function ReloadPartial() {
        $.ajax({
            url: '@Url.Action("ReloadEditPartial", "PlayGround")',
            data: {},
            type: 'POST',
            success: function (data) {
                $('#playGroundMsg').html(data);
                $('#popupwindow').dialog("close");
                return true;
            }
        });
    }

    function getRowCount() {
        var toReturn = null;
        $.ajax({
            url: "PlayGround/GetRowCount",
            async: false,
            cache: false,
            type: 'Get',
            dataType: 'html',
            data: {}
        }).success(function (data) {
            toReturn = data;
        }).error(function (xhr, status) {
            alert(xhr.responseText);
            return false;
        });
        return toReturn;
    }

    function SaveNew() {
        //        var modelDataJSON = '@Html.Raw(Json.Encode(Model))';
        var Text = $("#text").val();
        if (Text == "") {
            alert('Please enter value.');
            return false;
        }
        var answer = confirm("Save New?");
        if (answer) {
            $.ajax({
                url: "PlayGround/New",
                async: false,
                cache: false,
                type: 'Get',
                dataType: 'html',
                data: { text: Text }
            }).success(function (data) {
                if (data == "Success") {
                    ReloadPartial();
                    return true;
                }
                else {
                    alert("Could not save, error.");
                    return false;
                }
            }).error(function (xhr, status) {
                alert(xhr.responseText);
                return false;
            });
        }
    }

    function Update() {
        var Text = $("#text").val();
        if (Text == "") {
            alert('Please enter value.');
            return false;
        }
        var id = '@ViewBag.id';
        var answer = confirm("Update?");
        if (answer) {
            $.ajax({
                url: "PlayGround/Update",
                async: false,
                cache: false,
                type: 'Get',
                dataType: 'html',
                data: { id: id, text: Text }
            }).success(function (data) {
                if (data == "Success") {
                    ReloadPartial();
                    return true;
                }
                else {
                    alert("Could not save, error.");
                }
            }).error(function (xhr, status) {
                alert(xhr.responseText);
                return false;
            });
        }
    }

    function Delete() {
        var id = '@ViewBag.id';
        var isLastRow = false;
        if (getRowCount() == "1") {
            isLastRow = true;
            //alert('One row must exist');
        }
        var answer = confirm("Delete?");
        if (answer) {
            $.ajax({
                url: "PlayGround/Delete",
                async: false,
                cache: false,
                type: 'Get',
                dataType: 'html',
                data: { id: id, isLastRowDeleted: isLastRow }
            }).success(function (data) {
                if (data == "Success") {
                    ReloadPartial();
                    return true;
                }
                else {
                    alert("Could not save, error.");
                    return false;
                }
            }).error(function (xhr, status) {
                alert(xhr.responseText);
            });
        }
    }
</script>

    @using (Html.BeginForm())
    {
        <div id="editForm">
        @Html.ValidationSummary(true)
        <table>
        <tr>
        <td>
            @Html.TextBoxFor(model => model.text)
        </td>
        </tr>
        </table>
        <input type="button" value="Update" onclick="Update()"/>
        <input type="button" value="Save New" onclick="SaveNew()"/>
        <input type="button" value="Delete" onclick="Delete()"/>
        </div>
    }
